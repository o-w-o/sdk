<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="840px" preserveAspectRatio="none" style="width:910px;height:840px;" version="1.1" viewBox="0 0 910 840" width="910px" zoomAndPan="magnify"><defs><filter height="300%" id="f40vkr2lfd7e6" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="126" x="387.5" y="47.2852">接口授权与认证</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="41" x2="41" y1="144.3604" y2="726.4307"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="295" x2="295" y1="144.3604" y2="726.4307"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="529.5" x2="529.5" y1="144.3604" y2="726.4307"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="691.5" x2="691.5" y1="144.3604" y2="726.4307"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="814" x2="814" y1="144.3604" y2="726.4307"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="872" x2="872" y1="144.3604" y2="726.4307"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="8" y="141.2842">User 用户</text><ellipse cx="41.5" cy="68.2402" fill="#FEFECE" filter="url(#f40vkr2lfd7e6)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M41.5,76.2402 L41.5,103.2402 M28.5,84.2402 L54.5,84.2402 M41.5,103.2402 L28.5,118.2402 M41.5,103.2402 L54.5,118.2402 " fill="none" filter="url(#f40vkr2lfd7e6)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="8" y="741.4746">User 用户</text><ellipse cx="41.5" cy="754.5508" fill="#FEFECE" filter="url(#f40vkr2lfd7e6)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M41.5,762.5508 L41.5,789.5508 M28.5,770.5508 L54.5,770.5508 M41.5,789.5508 L28.5,804.5508 M41.5,789.5508 L54.5,804.5508 " fill="none" filter="url(#f40vkr2lfd7e6)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="271.5" y="141.2842">Server</text><path d="M275,97.2402 L275,121.2402 M275,109.2402 L292,109.2402 " fill="none" filter="url(#f40vkr2lfd7e6)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="304" cy="109.2402" fill="#FEFECE" filter="url(#f40vkr2lfd7e6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="271.5" y="741.4746">Server</text><path d="M275,748.5508 L275,772.5508 M275,760.5508 L292,760.5508 " fill="none" filter="url(#f40vkr2lfd7e6)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="304" cy="760.5508" fill="#FEFECE" filter="url(#f40vkr2lfd7e6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="142" x="455.5" y="141.2842">Authorization 授权服务</text><ellipse cx="529.5" cy="109.2402" fill="#FEFECE" filter="url(#f40vkr2lfd7e6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="525.5,97.2402,531.5,92.2402,529.5,97.2402,531.5,102.2402,525.5,97.2402" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="142" x="455.5" y="741.4746">Authorization 授权服务</text><ellipse cx="529.5" cy="760.5508" fill="#FEFECE" filter="url(#f40vkr2lfd7e6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="525.5,748.5508,531.5,743.5508,529.5,748.5508,531.5,753.5508,525.5,748.5508" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="150" x="613.5" y="141.2842">Authentication 认证服务</text><ellipse cx="691.5" cy="109.2402" fill="#FEFECE" filter="url(#f40vkr2lfd7e6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="687.5,97.2402,693.5,92.2402,691.5,97.2402,693.5,102.2402,687.5,97.2402" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="150" x="613.5" y="741.4746">Authentication 认证服务</text><ellipse cx="691.5" cy="760.5508" fill="#FEFECE" filter="url(#f40vkr2lfd7e6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="687.5,748.5508,693.5,743.5508,691.5,748.5508,693.5,753.5508,687.5,748.5508" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47" x="788" y="141.2842">Service</text><ellipse cx="814.5" cy="109.2402" fill="#FEFECE" filter="url(#f40vkr2lfd7e6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="810.5,97.2402,816.5,92.2402,814.5,97.2402,816.5,102.2402,810.5,97.2402" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="47" x="788" y="741.4746">Service</text><ellipse cx="814.5" cy="760.5508" fill="#FEFECE" filter="url(#f40vkr2lfd7e6)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="810.5,748.5508,816.5,743.5508,814.5,748.5508,816.5,753.5508,810.5,748.5508" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="36" x="851" y="141.2842">Redis</text><path d="M854,89.2402 C854,79.2402 872,79.2402 872,79.2402 C872,79.2402 890,79.2402 890,89.2402 L890,115.2402 C890,125.2402 872,125.2402 872,125.2402 C872,125.2402 854,125.2402 854,115.2402 L854,89.2402 " fill="#FEFECE" filter="url(#f40vkr2lfd7e6)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M854,89.2402 C854,99.2402 872,99.2402 872,99.2402 C872,99.2402 890,99.2402 890,89.2402 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="36" x="851" y="741.4746">Redis</text><path d="M854,754.5508 C854,744.5508 872,744.5508 872,744.5508 C872,744.5508 890,744.5508 890,754.5508 L890,780.5508 C890,790.5508 872,790.5508 872,790.5508 C872,790.5508 854,790.5508 854,780.5508 L854,754.5508 " fill="#FEFECE" filter="url(#f40vkr2lfd7e6)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M854,754.5508 C854,764.5508 872,764.5508 872,764.5508 C872,764.5508 890,764.5508 890,754.5508 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#EEEEEE" filter="url(#f40vkr2lfd7e6)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="895" x="3" y="176.2375"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="898" y1="176.2375" y2="176.2375"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="898" y1="179.2375" y2="179.2375"/><rect fill="#EEEEEE" filter="url(#f40vkr2lfd7e6)" height="25.7544" style="stroke: #000000; stroke-width: 2.0;" width="44" x="428.5" y="164.3604"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="434.5" y="183.2583">授权</text><polygon fill="#A80036" points="283.5,219.8691,293.5,223.8691,283.5,227.8691,287.5,223.8691" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="41.5" x2="289.5" y1="223.8691" y2="223.8691"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="48.5" y="219.0127">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="59.5" y="219.0127">请求授权</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="155" x="119.5" y="219.0127">POST api/authentication</text><polygon fill="#A80036" points="517.5,251.6235,527.5,255.6235,517.5,259.6235,521.5,255.6235" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="295.5" x2="523.5" y1="255.6235" y2="255.6235"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="302.5" y="250.7671">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="313.5" y="250.7671">授权校验</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="143" x="369.5" y="250.7671">(username - password)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="529.5" x2="571.5" y1="287.3779" y2="287.3779"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="571.5" x2="571.5" y1="287.3779" y2="300.3779"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="530.5" x2="571.5" y1="300.3779" y2="300.3779"/><polygon fill="#A80036" points="540.5,296.3779,530.5,300.3779,540.5,304.3779,536.5,300.3779" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="536.5" y="282.5215">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="547.5" y="282.5215">校验通过，生成 Token</text><polygon fill="#A80036" points="860,328.1323,870,332.1323,860,336.1323,864,332.1323" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="529.5" x2="866" y1="332.1323" y2="332.1323"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="536.5" y="327.2759">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="547.5" y="327.2759">存放 (key=id,value=AuthorizedJwtStore) Token</text><polygon fill="#A80036" points="306.5,359.8867,296.5,363.8867,306.5,367.8867,302.5,363.8867" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="300.5" x2="528.5" y1="363.8867" y2="363.8867"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="312.5" y="359.0303">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="327.5" y="359.0303"/><polygon fill="#A80036" points="52.5,391.6411,42.5,395.6411,52.5,399.6411,48.5,395.6411" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46.5" x2="294.5" y1="395.6411" y2="395.6411"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="58.5" y="390.7847">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="69.5" y="390.7847">认证成功返回 Token</text><rect fill="#EEEEEE" filter="url(#f40vkr2lfd7e6)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="895" x="3" y="425.5183"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="898" y1="425.5183" y2="425.5183"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="898" y1="428.5183" y2="428.5183"/><rect fill="#EEEEEE" filter="url(#f40vkr2lfd7e6)" height="25.7544" style="stroke: #000000; stroke-width: 2.0;" width="44" x="428.5" y="413.6411"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="26" x="434.5" y="432.5391">认证</text><polygon fill="#A80036" points="283.5,469.1499,293.5,473.1499,283.5,477.1499,287.5,473.1499" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="41.5" x2="289.5" y1="473.1499" y2="473.1499"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="48.5" y="468.2935">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="59.5" y="468.2935">请求服务</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="88" x="119.5" y="468.2935">POST api/xxx</text><polygon fill="#A80036" points="679.5,500.9043,689.5,504.9043,679.5,508.9043,683.5,504.9043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="295.5" x2="685.5" y1="504.9043" y2="504.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="302.5" y="500.0479">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="313.5" y="500.0479">权限认证</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="140" x="369.5" y="500.0479">(Authorization: Token)</text><polygon fill="#A80036" points="860,532.6587,870,536.6587,860,540.6587,864,536.6587" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="691.5" x2="866" y1="536.6587" y2="536.6587"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7" x="698.5" y="531.8022">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="709.5" y="531.8022">获取 服务端 Token</text><polygon fill="#A80036" points="702.5,564.4131,692.5,568.4131,702.5,572.4131,698.5,568.4131" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="696.5" x2="871" y1="568.4131" y2="568.4131"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="708.5" y="563.5566">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="726.5" y="563.5566">获取 服务端 Token</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="691.5" x2="733.5" y1="600.1675" y2="600.1675"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="733.5" x2="733.5" y1="600.1675" y2="613.1675"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692.5" x2="733.5" y1="613.1675" y2="613.1675"/><polygon fill="#A80036" points="702.5,609.1675,692.5,613.1675,702.5,617.1675,698.5,613.1675" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="698.5" y="595.311">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="716.5" y="595.311">Token 校验通过</text><polygon fill="#A80036" points="802.5,640.9219,812.5,644.9219,802.5,648.9219,806.5,644.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="691.5" x2="808.5" y1="644.9219" y2="644.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="698.5" y="640.0654">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="716.5" y="640.0654">执行服务</text><polygon fill="#A80036" points="306.5,672.6763,296.5,676.6763,306.5,680.6763,302.5,676.6763" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="300.5" x2="813.5" y1="676.6763" y2="676.6763"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="312.5" y="671.8198">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="334.5" y="671.8198"/><polygon fill="#A80036" points="52.5,704.4307,42.5,708.4307,52.5,712.4307,48.5,708.4307" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46.5" x2="294.5" y1="708.4307" y2="708.4307"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="58.5" y="703.5742">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="80.5" y="703.5742"/><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="30" x="868" y="14.46">烛火录</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="55" x="423" y="827.0107">Page 1 of 1</text><!--MD5=[4c505223ff3eac2b8ce3075053ae399e]
@startuml
header 烛火录
footer Page %page% of %lastpage%

title 接口授权与认证

autonumber

actor "User 用户" as User
boundary Server
control "Authorization 授权服务" as Authorization
control "Authentication 认证服务" as Authentication
control Service
database Redis

== 授权 ==

User -> Server : 请求授权 ** POST api/authentication **
Server -> Authorization : 授权校验 **(username - password)**
Authorization -> Authorization : 校验通过，生成 Token
Authorization -> Redis : 存放 (key=id,value=AuthorizedJwtStore) Token
Authorization -> Server
Server -> User : 认证成功返回 Token

== 认证 ==

User -> Server : 请求服务 ** POST api/xxx **
Server -> Authentication : 权限认证 **(Authorization: Token)**
Authentication -> Redis : 获取 服务端 Token
Redis -> Authentication : 获取 服务端 Token
Authentication -> Authentication : Token 校验通过
Authentication -> Service : 执行服务
Service -> Server
Server -> User

@enduml

PlantUML version 1.2020.09(Sun May 10 18:51:06 CST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.7+10-b765.53
Operating System: Windows 10
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg>